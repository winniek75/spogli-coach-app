# レッスン動画ストレージシステム実装計画

## 推奨構成：Supabase Storage + 段階的移行

### フェーズ1: Supabase Storage（すぐに実装可能）
- 無料枠: 1GB ストレージで開始
- 小規模な動画から開始（5-10分の動画で約50-100MB）
- 約10-20本の動画を保存可能

### フェーズ2: 容量増加時の対応（1-3ヶ月後）
- Supabase有料プラン（$25/月）へ移行
- 100GBストレージで約1000本の動画保存可能

### フェーズ3: 大規模化対応（必要に応じて）
- Cloudflare Streamへ移行（$5/月〜）
- 無制限ストレージ
- 自動エンコード・最適化

## 実装手順

### 1. Supabase Storage バケット作成
```sql
-- Supabase Dashboardで実行
-- Storage > New Bucket から作成
-- バケット名: lesson-videos
-- Public: false（認証が必要）
```

### 2. アップロード機能の実装
- ファイルサイズ制限: 500MB/動画
- 対応形式: MP4, MOV, WebM
- 自動圧縮オプション

### 3. 動画配信の最適化
- プログレッシブダウンロード
- サムネイル自動生成
- キャッシュ戦略

## コスト最適化のヒント

1. **動画圧縮**
   - アップロード前にHandBrakeで圧縮
   - 1080p → 720pで約50%削減
   - H.264コーデック使用

2. **段階的アップロード**
   - 重要な動画から順次アップロード
   - 古い動画は定期的に見直し

3. **キャッシュ活用**
   - ブラウザキャッシュ設定
   - CDN活用（Cloudflare無料プラン）

## 料金シミュレーション

### 100本の動画（各100MB）の場合：
- **Supabase無料枠**: 0円（10GBまで）
- **Supabase有料**: $25/月（100GBまで）
- **Cloudflare Stream**: 約$10/月（視聴時間による）
- **YouTube**: 0円（制限あり）

## セキュリティ対策

1. **アクセス制御**
   - 講師のみアクセス可能
   - トークンベース認証
   - 有効期限付きURL

2. **コンテンツ保護**
   - ダウンロード制限
   - 右クリック無効化
   - 透かし追加（オプション）

## 実装優先順位

1. ✅ Supabase Storage統合
2. ⬜ 動画アップロード機能
3. ⬜ 動画管理画面
4. ⬜ 講師向け視聴ページ
5. ⬜ 視聴履歴・分析機能